<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TikGSM — Админка</title>
  <style>
    :root { --bg:#f6f7f9; --panel:#fff; --fg:#111; --muted:#666; --accent:#000; --shadow:0 6px 18px rgba(0,0,0,.08); }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:var(--fg)}
    header{background:#000;color:#fff;padding:16px 20px;font-weight:700;text-align:center}
    .wrap{max-width:1000px;margin:24px auto;padding:0 16px}
    .panel{background:var(--panel);border-radius:16px;box-shadow:var(--shadow);padding:18px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    input, textarea, button{width:100%;padding:12px 12px;border:1px solid #e3e5ea;border-radius:10px;font-size:15px}
    textarea{min-height:90px;resize:vertical}
    button{background:#000;color:#fff;border:0;font-weight:700;cursor:pointer}
    button:hover{opacity:.9}
    .actions{display:flex;gap:10px}
    .danger{background:#e53935}
    .warn{background:#ff9800}
    .list{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .item{background:#fff;border-radius:14px;box-shadow:var(--shadow);padding:12px}
    .item img{width:100%;height:140px;object-fit:cover;border-radius:10px;background:#f3f3f3}
    .muted{color:var(--muted);font-size:13px}
    .hidden{display:none}
    .login{max-width:380px;margin:60px auto}
  </style>
</head>
<body>
<header>TikGSM — Админка</header>

<main class="wrap">

  <!-- Блок логина -->
  <section id="loginBox" class="panel login">
    <h3>Вход</h3>
    <div class="grid">
      <input id="email" type="email" placeholder="Email (например, admin@site.com)" />
      <input id="password" type="password" placeholder="Пароль" />
      <button id="loginBtn">Войти</button>
      <p class="muted">Если ещё нет пользователя — см. шаги ниже (Firebase → Authentication).</p>
    </div>
  </section>

  <!-- Панель управления -->
  <section id="adminBox" class="panel hidden">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <h3 style="margin:0">Добавить / Редактировать товар</h3>
      <button id="logoutBtn" class="warn" title="Выйти">Выйти</button>
    </div>

    <div class="grid">
      <div class="row">
        <input id="name"  placeholder="Название" />
        <input id="price" placeholder="Цена (любой формат)" />
      </div>
      <input id="image" placeholder="Ссылка на фото (.jpg/.png/.webp)" />
      <textarea id="description" placeholder="Описание"></textarea>
      <div class="actions">
        <button id="saveBtn">Сохранить</button>
        <button id="resetBtn" class="warn" type="button">Очистить форму</button>
      </div>
    </div>

    <h3 style="margin:18px 0 8px">Товары</h3>
    <div id="list" class="list"></div>
  </section>

</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getDatabase, ref, push, set, remove, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  // ⚠️ ВСТАВЬ СВОЙ КОНФИГ из Firebase Console (кроме databaseURL — уже подставлен твой).
  const firebaseConfig = {
    apiKey: "AIzaSyDv8hgKDI_4GFyJAuKMZU8qPOxNhLc_Ilc",
    authDomain: "tikgsm.firebaseapp.com",
    projectId: "tikgsm",
    storageBucket: "tikgsm.firebasestorage.app",
    messagingSenderId: "311832408580",
    appId: "1:311832408580:web:4f8f622a5333bf95457b51",
    measurementId: "G-WHT99GXH1Y"
    databaseURL: "https://tikgsm-default-rtdb.europe-west1.firebasedatabase.app"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getDatabase(app);

  // UI элементы
  const loginBox  = document.getElementById('loginBox');
  const adminBox  = document.getElementById('adminBox');
  const emailEl   = document.getElementById('email');
  const passEl    = document.getElementById('password');
  const loginBtn  = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  const nameEl  = document.getElementById('name');
  const priceEl = document.getElementById('price');
  const imageEl = document.getElementById('image');
  const descEl  = document.getElementById('description');
  const saveBtn = document.getElementById('saveBtn');
  const resetBtn= document.getElementById('resetBtn');
  const listEl  = document.getElementById('list');

  const productsRef = ref(db, 'products');
  let editKey = null; // если != null — редактируем

  // Авторизация
  loginBtn.onclick = async () => {
    try {
      await signInWithEmailAndPassword(auth, emailEl.value.trim(), passEl.value.trim());
    } catch (e) {
      alert('Ошибка входа: ' + e.message);
    }
  };
  logoutBtn.onclick = async () => { await signOut(auth); };

  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginBox.classList.add('hidden');
      adminBox.classList.remove('hidden');
      loadProducts();
    } else {
      adminBox.classList.add('hidden');
      loginBox.classList.remove('hidden');
      listEl.innerHTML = '';
    }
  });

  // CRUD
  function loadProducts() {
    onValue(productsRef, (snap) => {
      listEl.innerHTML = '';
      const data = snap.val() || {};
      const keys = Object.keys(data).reverse();
      keys.forEach((key) => {
        const p = data[key];
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="${p.image || ''}" alt="">
          <div style="padding:8px 2px">
            <div style="font-weight:700;margin:4px 0">${p.name || 'Без названия'}</div>
            <div class="muted" style="margin:2px 0">${p.price || ''}</div>
            <div class="muted" style="margin:6px 0">${p.description || ''}</div>
            <div class="actions" style="margin-top:8px">
              <button class="warn">Редактировать</button>
              <button class="danger">Удалить</button>
            </div>
          </div>
        `;
        const [editBtn, delBtn] = div.querySelectorAll('button');
        editBtn.onclick = () => {
          editKey = key;
          nameEl.value  = p.name || '';
          priceEl.value = p.price || '';
          imageEl.value = p.image || '';
          descEl.value  = p.description || '';
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        delBtn.onclick = () => remove(ref(db, 'products/' + key));
        listEl.appendChild(div);
      });
    });
  }

  saveBtn.onclick = async () => {
    const name = nameEl.value.trim();
    const price = priceEl.value.trim();
    const image = imageEl.value.trim();
    const description = descEl.value.trim();
    if (!name || !price || !image || !description) return alert('Заполни все поля');

    if (editKey) {
      await set(ref(db, 'products/' + editKey), { name, price, image, description });
      editKey = null;
    } else {
      await push(productsRef, { name, price, image, description });
    }
    nameEl.value = priceEl.value = imageEl.value = descEl.value = '';
  };

  resetBtn.onclick = () => {
    editKey = null;
    nameEl.value = priceEl.value = imageEl.value = descEl.value = '';
  };
</script>
</body>
</html>
